openapi: 3.0.3
info:
  title: BitKa Exchange API
  version: "0.3.0"
  description: |
    BitKa Exchange public API.

    This API Gateway unifies all microservices. You can connect to the Gateway (recommended) or directly to individual services during development.

    ### ðŸ–¥ï¸ Server Environment Reference

    | Service | URL | Description |
    | :--- | :--- | :--- |
    | **Gateway (Traefik)** | `http://localhost:80` | **Primary Entrypoint.** Routes to all services based on path. |
    | **Auth Service** | `http://localhost:3000` | Direct access to Auth (Login, JWT). |
    | **User Service** | `http://localhost:3001` | Direct access to User profiles & KYC. |
    | **Ledger Service** | `http://localhost:3002` | Direct access to Wallets & Transactions. |
    | **Order Service** | `http://localhost:3003` | Direct access to Order placement. |
    | **MarketData** | `http://localhost:3004` | Direct access to Public data (Candles/Ticks). |

    # Note

    ## The 3 States of a Property in OpenAPI

    Every field can be described using **two dimensions**:

    | Dimension                 | Meaning                                           |
    | ------------------------- | ------------------------------------------------- |
    | **required (true/false)** | Whether the key **must exist** in the JSON object |
    | **nullable (true/false)** | Whether the value is allowed to be **`null`**     |

    So we get **four combinations**.

    ---

    ### 1. **Required + Not Nullable**

    ```yaml
    properties:
      data:
        type: object
    required: ["data"]
    ```

    JSON:

    âœ”ï¸ `"data": {...}`
    âŒ `"data": null`
    âŒ missing `"data"`

    This means:

    > The property MUST exist and must **not** be null.

    ---

    ### 2. **Optional + Not Nullable**

    ```yaml
    properties:
      data:
        type: object
    # not in required list
    ```

    JSON:

    âœ”ï¸ `"data": {...}`
    âœ”ï¸ omit `"data"`
    âŒ `"data": null`

    Meaning:

    > If the server includes this field, it must NOT be null.
    > But the server is allowed to drop/omit this field entirely.

    This is what you called **â€œun-identifiedâ€** â†’ not required and not nullable.

    ---

    ### 3. **Required + Nullable**

    ```yaml
    properties:
      data:
        type: object
        nullable: true
    required: ["data"]
    ```

    JSON:

    âœ”ï¸ `"data": {...}`
    âœ”ï¸ `"data": null`
    âŒ missing `"data"`

    Meaning:

    > The key must be present, but value can be null.

    Rarely good design â€” but sometimes used when you want:

    * structural consistency
    * but the data payload may be empty

    ---

    ### 4. **Optional + Nullable**

    ```yaml
    properties:
      data:
        type: object
        nullable: true
    # not required
    ```

    JSON:

    âœ”ï¸ `"data": {...}`
    âœ”ï¸ `"data": null`
    âœ”ï¸ omit `"data"`

    Meaning:

    > Very permissive. The server can omit the field or return null.

    Often *too flexible* for reliable client code.

    ---

servers:
  - url: https://api.bitka.polishstack.com
    description: Production server
  - url: https://localhost:80
    description: Local traefik server
  - url: https://localhost:3000
    description: Local auth service server
  - url: https://localhost:3001
    description: Local user service server
  - url: https://localhost:3002
    description: Local ledger service server
  - url: https://localhost:3003
    description: Local order service server
  - url: https://localhost:3004
    description: Local marketdata service server

paths:
  /auth/v1/login:
    $ref: './paths/auth.yaml#/paths/~1auth~1v1~1login'
  /auth/v1/register:
    $ref: './paths/auth.yaml#/paths/~1auth~1v1~1register'
  /auth/v1/refresh:
    $ref: './paths/auth.yaml#/paths/~1auth~1v1~1refresh'
  /auth/v1/logout:
    $ref: './paths/auth.yaml#/paths/~1auth~1v1~1logout'
  /./v1well-known/jwks.json:
    $ref: './paths/auth.yaml#/paths/~1.well-known~1jwks.json'

  /users/v1/me:
    $ref: './paths/user.yaml#/paths/~1users~1v1~1me'
  /users/v1/{id}:
    $ref: './paths/user.yaml#/paths/~1users~1v1~1{id}'
  /users/v1/me/change-password:
    $ref: './paths/user.yaml#/paths/~1users~1v1~1me~1change-password'

  /ledger/v1/accounts:
    $ref: './paths/ledger.yaml#/paths/~1ledger~1v1~1accounts'
  /ledger/v1/accounts/{account_id}:
    $ref: './paths/ledger.yaml#/paths/~1ledger~1v1~1accounts~1{account_id}'
  /ledger/v1/transactions:
    $ref: './paths/ledger.yaml#/paths/~1ledger~1v1~1transactions'
  /ledger/v1/transactions/{transaction_id}:
    $ref: './paths/ledger.yaml#/paths/~1ledger~1v1~1transactions~1{transaction_id}'

  /orders/v1:
    $ref: './paths/order.yaml#/paths/~1orders'
  /orders/v1/{order_id}:
    $ref: './paths/order.yaml#/paths/~1orders~1v1~1{order_id}'

  /marketdata/v1/symbols:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1symbols'
  /marketdata/v1/candles:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1candles'
  /marketdata/v1/ticks:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1ticks'
  /marketdata/v1/orderbook/{symbol}:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1orderbook~1{symbol}'
  /marketdata/v1/orderbook/{symbol}/history:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1orderbook~1{symbol}~1history'
  /marketdata/v1/stream:
    $ref: './paths/market.yaml#/paths/~1marketdata~1v1~1stream'


components:
  schemas:
    $ref: './components/schemas.yaml#/components/schemas'
  securitySchemes:
    $ref: './components/security.yaml#/components/securitySchemes'

security:
  - bearerAuth: []